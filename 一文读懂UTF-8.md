# 一文读懂UTF-8

UTF-8（Unicode Transformation Format–8）是一种可变长度的**字符编码方式**，用来将**世界上各种语言的字符**转换成**计算机可以识别和处理的二进制数据（即字节序列）**。

## 为什么需要 UTF-8 编码？

计算机只能处理二进制数据（0和1），但我们人类使用的是文字。为了让计算机处理文本，就需要一种方式将“字符 ↔ 二进制”进行转换，这就是字符编码的作用。

## UTF-8 是什么？

UTF-8 是一种将 Unicode 编码以字节为单位传输的方式，由 Ken Thompson 和 Rob Pike 设计，是目前世界上最常用的字符编码方式之一。

UTF-8 的关键特征：

- 可变长度编码：每个字符用1~4个字节来表示
- 向后兼容 ASCII：ASCII 中的字符在 UTF-8 中还是用原来的 1 个字节表示
- 支持全球所有语言字符
- 互联网标准编码格式（如 HTML、JSON 默认都用 UTF-8）

UTF-8 的设计目标之一是向后兼容 ASCII：Unicode 的前 128 个字符（U+0000–U+007F）与 ASCII 一一对应，用单字节表示，二进制值完全相同。UTF-8 后来成为互联网的主流编码形式，Unicode 标准本身将 UTF-8 作为推荐的编码方式之一。总结来说，UTF-8 起源于对多语言字符集（Unicode）的需求，通过多字节可变长度编码实现全面支持而兼容传统 ASCII。

## UTF-8 编码原理

假设我们要编码字符”中“

1. 查 Unicode 编码表：

   - ”中“的 Unicode 编码是：`U+4E2D`
   - `U+4E2D` 是一个十六进制数，对应的十进制是：`20013`
   - 十进制 `20013` 转换成二进制是：`01001110 00101101`（16位）

2. UTF-8 编码规则如下：

   | 字节数 | Unicode 范围       | UTF-8 二进制格式                    |
   | ------ | ------------------ | ----------------------------------- |
   | 1 字节 | U+0000 - U+007F    | 0xxxxxxx                            |
   | 2 字节 | U+0080 - U+07FF    | 110xxxxx 10xxxxxx                   |
   | 3 字节 | U+0800 - U+FFFF    | 1110xxxx 10xxxxxx 10xxxxxx          |
   | 4 字节 | U+10000 - U+10FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx |

   "中" 属于第三行（U+0800 - U+FFFF），需要用 **3 个字节**：

   ```bash
   格式：1110xxxx 10xxxxxx 10xxxxxx
   填入 16 位二进制：0100111000101101
           ↓ 分段：0100 111000 101101
           ↓ 填充：11100100 10111000 10101101
   ```

   最终 UTF-8 编码为：

   - 十六进制：`E4 B8 AD`
   - 二进制：`11100100 10111000 10101101`

## 常见误区澄清

- **UTF-8 ≠ Unicode**

  Unicode 是字符的“编号系统”，UTF-8 是把这个编号转为二进制字节的具体方式

- **UTF-8 是变长编码，不是每个字符都占 1 字节**

  在 Solidity 和绝大多数现代编程语言中，**字符串采用 UTF-8 编码**。在 UTF-8 中：

  | 字符范围               | UTF-8 编码长度 |
  | ---------------------- | -------------- |
  | 英文字符（ASCII）      | 1 字节         |
  | 拉丁字母扩展等         | 2 字节         |
  | 常见汉字（中日韩）     | 3 字节         |
  | 一些罕见汉字、Emoji 等 | 4 字节         |

  因此：

  - 常见中文汉字，如 “你”、“我”、“他”、“是”等都是 3 个字节（24 位）
  - 罕见汉字或生僻字，可能是 4 个字节（32 位），例如：”𠮷“
  - Emoji 表情通常是 4 个字节，例如 "😊"



1. 
2. 
3. 



